{% extends 'base.html.twig' %}

{% block title %}Soumettre ma candidature
{% endblock %}

{% block body %}
	{# Fil d'arianne #}
	<nav role="navigation" class="fr-breadcrumb" aria-label="vous êtes ici :">
		<button type="button" class="fr-breadcrumb__button" aria-expanded="false" aria-controls="breadcrumb">Voir le fil d&#39;arianne</button>

		<div class="fr-collapse" id="breadcrumb">
			<ol class="fr-breadcrumb__list">
				<li>
					<a class="fr-breadcrumb__link" id="segment-0" href="/">Accueil</a>
				</li>
				<li>
					<a class="fr-breadcrumb__link" id="segment-1" aria-current="page" href="/index/candidat">Soumettre ma candidature</a>
				</li>
			</ol>
		</div>
	</nav>
	{# Fin fil d'arianne #}

	<h2 class="fr-mt-2w">
		Soumettre ma candidature
	</h2>

	<p class="fr-text--sm fr-mb-1w">
		L'unité organisatrice de cette élection a autorisé les candidatures spontanées.
		<br>
		Pour soumettre votre candidature, cochez la case ci-dessous.
		<br>
		<a href="/" target="_self" class="fr-link fr-icon-arrow-left-line fr-link--icon-left">Revenir à l'accueil.</a>
	</p>

	<main>

		<div class="fr-grid-row fr-grid-row--gutters fr-mt-4w">

			{% if election is not null %}

				<div class="fr-col-sm-12 fr-col-md-5 fr-col-lg-5 fr-col-xl-4 custom-card-container">

					<h3 class="fr-h4 center">Caractéristiques</h3>

					<div class="fr-tile fr-enlarge-link" id="tile-4">
						<div class="fr-tile__body">
							<div class="fr-tile__content">
								<h3 class="fr-tile__title">
									<button type="button" class="custom-tile-menu--opener{# fr-icon-more-fill#}" id="election-{{ election.id }}-btn">
										{{ election.title }}
									</button>
								</h3>
								<p class="fr-tile__desc">{{ election.explaination }}</p>
								<p class="fr-tile__detail">
									Créée par&nbsp;
									{{ election.user.title }}

									<ul class="fr-tags-group">
										{% for grp in election.groupesConcernes %}
											<li>
												<p class="fr-tag fr-tag--défaut" id="tag-group-0">{{ grp.shortName }}</p>
											</li>
										{% endfor %}
									</ul>

								</p>

								{# <div class="fr-tile__start">
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	{% set badge_class = election.isNotOpenYet()? 'fr-badge--purple-glycine' : election.isOpen() ? 'fr-badge--success': '' %}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	{% set badge_title = election.isNotOpenYet()? 'Ouverture prochaine' : election.isOpen() ? 'L\'élection est ouverte': 'Élection fermée' %}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																								
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	<p class="fr-badge {{ badge_class }}" title="{{ badge_title }}">Votes ouverts du
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																		{{ election.startDate | date('d/m/Y') }}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																		au
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																		{{ election.endDate | date('d/m/Y') }}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	</p>
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																															</div> #}
							</div>
							<!-- fin .fr-tile__content -->
						</div>
						<!-- fin .fr-tile__body -->

						<div class="fr-tile__header">
							<div class="fr-tile__pictogram">
								<svg aria-hidden="true" class="fr-artwork" viewbox="0 0 80 80" width="80px" height="80px">
									<use class="fr-artwork-decorative" href="{{ asset('artwork/pictograms/buildings/city-hall.svg') }}#artwork-decorative"></use>
									<use class="fr-artwork-minor" href="{{ asset('artwork/pictograms/buildings/city-hall.svg') }}#artwork-minor"></use>
									<use class="fr-artwork-major" href="{{ asset('artwork/pictograms/buildings/city-hall.svg') }}#artwork-major"></use>
								</svg>
							</div>
						</div>

						<div class="custom-tile-menu">
							<menu class="fr-btns-group">
								<li>
									<button type="button" class="custom-tile-menu--closer fr-btn fr-icon-close-line fr-btn--icon-right fr-btn--tertiary-no-outline">Fermer</button>
								</li>
								<li>
									<a target="_self" href="/election/clone/{{election.id}}" class="fr-btn fr-btn--tertiary">Cloner cette élection</a>
								</li>
								<li>
									<a target="_self" href="/election/edit/{{election.id}}" class="fr-btn fr-btn--tertiary">Modifier cette élection</a>
								</li>
								<li>
									<a target="_self" href="#" class="fr-btn fr-btn--tertiary">Gérer les candidats</a>
								</li>
								<li>
									<button disabled target="_self" href="/election/candidats/{{election.id}}" class="fr-btn fr-btn--tertiary">Partager cette élection</button>
								</li>
								<li>
									<a target="_self" href="/election/cancel/{{election.id}}" class="custom-link--icon fr-link">Annuler cette élection</a>
								</li>
							</menu>
						</div>

					</div>
					<!-- fin .fr-tile -->

				</div>
				<!-- fin .fr-col -->

				<div class="fr-col-sm-12 fr-col-md-7 fr-col-lg-7 fr-col-xl-8 custom-card-container">

					<div class="fr-grid-row">

						<h3 class="fr-h4 center">Candidatures</h3>

						<form method="GET" action="{{ path('search_users') }}">

							<div class="fr-grid-row fr-grid-row--gutters">

								<h4 class="fr-h6 fr-col-12 fr-mb-0">
									Je me porte candidat
								</h4>

								{% set user_is_candidat = election.candidats | find(candidat => candidat.userId == user.userId ) %}

								<div class="fr-col-12 fr-mb-2w">
									<div class="fr-checkbox-group">
										<input name="checkbox" {{ user_is_candidat ? 'checked ' : '' }} data-nigend="{{ user.userId }}" data-displayname="{{ user.title }}" data-mail="{{ user.mail }}" id="check-soumettre-candidature" type="checkbox" aria-describedby="checkbox-messages">
										<label class="fr-label" for="check-soumettre-candidature">
											Je, soussigné
											{{ user.title }}, me porte candidat à l'élection dont les caractéristiques figurent sur cette page.
										</label>
										<div class="fr-messages-group" id="check-soumettre-candidature-messages" aria-live="polite"></div>
									</div>

									{% if user_is_candidat %}
										<div class="fr-alert fr-alert--info fr-mt-2w">
											<h3 class="fr-alert__title">Votre candidature a bien été prise en compte.
											</h3>
										</div>
									{% endif %}
								</div>

							</div>
						</div>
					</form>

					<div class="fr-table fr-table--no-scroll" id="table-candidats-component">
						<div class="fr-table__wrapper">
							<div class="fr-table__container">
								<div class="fr-table__content">
									<table id="table-candidats">
										<caption>Candidats déjà inscrits</caption>
										<thead>
											<tr>
												<th>
													Nigend
												</th>
												<th>
													Utilisateur
												</th>
											</tr>
										</thead>
										<tbody id="candidats-tbody">
											{% for candidat in election.candidats %}

												<tr id="table-candidats-row-key-1" data-row-key="1">
													<td>
														{{ candidat.userId }}
													</td>
													<td>
														{{ candidat.displayname }}
													</td>
												</tr>

											{% else %}

												<tr id="table-zero-candidat" data-row-key="1">
													<td colspan="2" class="center">
														Il n'y a pas encore de candidat pour cette élection. Soyez le premier!
													</td>
												</tr>

											{% endfor %}
										</tbody>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

			</div>
			<!-- fin .fr-col -->

		{% else %}

			<div class="fr-notice fr-notice--info">
				<div class="fr-container">
					<div class="fr-notice__body">
						<p>
							<span class="fr-notice__title">Aucune élection n'a été trouvée avec les caractéristiques demandées.</span>
							<a href="/election/dashboard" target="_self" class="fr-notice__link">Accédez à cette page depuis le tableau de bord!</a>
						</p>
					</div>
				</div>
			</div>

		{% endif %}

	</div>

</main>{% endblock %}
