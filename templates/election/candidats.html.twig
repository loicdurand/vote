{% extends 'base.html.twig' %}

{% block title %}Gestion des candidats
{% endblock %}

{% block body %}
	{# Fil d'arianne #}
	<nav role="navigation" class="fr-breadcrumb" aria-label="vous êtes ici :">
		<button type="button" class="fr-breadcrumb__button" aria-expanded="false" aria-controls="breadcrumb">Voir le fil d&#39;arianne</button>

		<div class="fr-collapse" id="breadcrumb">
			<ol class="fr-breadcrumb__list">
				<li>
					<a class="fr-breadcrumb__link" id="segment-0" href="{{ path('app_index') }}">Accueil</a>
				</li>
				{% if not spontanee %}
					<li>
						<a class="fr-breadcrumb__link" id="segment-1" href="{{ path('app_election_dashboard') }}">Tableau de bord des élections</a>
					</li>
				{% endif %}
				<li>
					<a class="fr-breadcrumb__link" id="segment-2" aria-current="page" href="{{ path('app_election_candidats') }}">{{ spontanee ? 'Soumettre ma candidature' : 'Gestion des candidats' }}</a>
				</li>
			</ol>
		</div>
	</nav>
	{# Fin fil d'arianne #}
	{% if spontanee %}

		<h2 class="fr-mt-2w">
			Soumettre ma candidature
		</h2>

		<p class="fr-text--sm fr-mb-3w">
			L'organisateur de cette élection a autorisé les candidatures spontanées.
			<br>
			Par conséquent, vous avez la possibilité de soumettre votre candidature à l'élection intitulée&nbsp;"<strong>{{ election.title }}</strong>".
		</p>

		{% if election.explaination != '' %}
			<figure class="fr-quote">
				<blockquote>
					<p class="fr-text--md">«
						{{ election.explaination }}
						»</p>
				</blockquote>
				<figcaption>
					<p class="fr-quote__author">{{ user.title }}</p>
					<ul class="fr-quote__source">
						<li>
							<cite>Organisateur</cite>
						</li>
					</ul>
				</figcaption>
			</figure>
		{% endif %}

	{% else %}

		<h2 class="fr-mt-2w">
			Gestion des candidats
		</h2>

		<p class="fr-text--sm fr-mb-1w">
			Cette page vous permet, au choix:
			<br>
			- d'ajouter les candidats directement, si vous en avez déjà la liste,
			<br>
			- de consulter les utilisateurs qui se sont portés candidat à leur initiative.
		</p>

	{% endif %}

	<main>

		<div class="fr-grid-row fr-grid-row--gutters fr-mt-4w">

			{% if election is not null %}

				<div class="fr-col-sm-12 fr-col-md-5 fr-col-lg-5 fr-col-xl-4 custom-card-container">

					<h3 class="fr-h4 center">Caractéristiques</h3>

					<div class="fr-tile fr-enlarge-link" id="tile-4">
						<div class="fr-tile__body">
							<div class="fr-tile__content">
								<h3 class="fr-tile__title">
									<button type="button" class="custom-tile-menu--opener{# fr-icon-more-fill#}" id="election-{{ election.id }}-btn">
										{{ election.title }}
									</button>
								</h3>
								<p class="fr-tile__desc">{{ election.explaination }}</p>
								<p class="fr-tile__detail">
									Créée par&nbsp;
									{{ election.user.title }}

									<ul class="fr-tags-group">
										{% for grp in election.groupesConcernes %}
											<li>
												<p class="fr-tag fr-tag--défaut" id="tag-group-0">{{ grp.shortName }}</p>
											</li>
										{% endfor %}
									</ul>

								</p>

							</div>
							<!-- fin .fr-tile__content -->
						</div>
						<!-- fin .fr-tile__body -->

						<div class="fr-tile__header">
							<div class="fr-tile__pictogram">
								<svg aria-hidden="true" class="fr-artwork" viewbox="0 0 80 80" width="80px" height="80px">
									<use class="fr-artwork-decorative" href="{{ asset('artwork/pictograms/buildings/city-hall.svg') }}#artwork-decorative"></use>
									<use class="fr-artwork-minor" href="{{ asset('artwork/pictograms/buildings/city-hall.svg') }}#artwork-minor"></use>
									<use class="fr-artwork-major" href="{{ asset('artwork/pictograms/buildings/city-hall.svg') }}#artwork-major"></use>
								</svg>
							</div>
						</div>

						<div class="custom-tile-menu">
							<menu class="fr-btns-group">
								<li>
									<button type="button" class="custom-tile-menu--closer fr-btn fr-icon-close-line fr-btn--icon-right fr-btn--tertiary-no-outline">Fermer</button>
								</li>
								<li>
									<a target="_self" href="{{ path('app_election_prepare', {action: 'clone', election_id: election.id} )}}" class="fr-btn fr-btn--tertiary">Cloner cette élection</a>
								</li>
								<li>
									<a target="_self" href="{{ path('app_election_prepare', {action: 'edit', election_id: election.id} )}}" class="fr-btn fr-btn--tertiary">Modifier cette élection</a>
								</li>
								<li>
									<a target="_self" href="#" class="fr-btn fr-btn--tertiary">Gérer les candidats</a>
								</li>
								<li>
									<button disabled target="_self" href="{{ path('app_election_candidats',{election_id: election.id}) }}" class="fr-btn fr-btn--tertiary">Partager cette élection</button>
								</li>
								<li>
									<a target="_self" href="{{ path('app_election_prepare', {action: 'cancel', election_id: election.id} )}}" class="custom-link--icon fr-link">Annuler cette élection</a>
								</li>
							</menu>
						</div>

					</div>
					<!-- fin .fr-tile -->

				</div>
				<!-- fin .fr-col -->

				<div class="fr-col-sm-12 fr-col-md-7 fr-col-lg-7 fr-col-xl-8 custom-card-container">

					<div class="fr-grid-row">

						<h3 class="fr-h4 center">{{ spontanee ? 'Candidats inscrits' : 'Candidatures' }}</h3>

						{% if not spontanee  %}

							<form method="GET" action="{{ path('search_users') }}">

								<div class="fr-grid-row fr-grid-row--gutters">

									<h4 class="fr-h6 fr-col-12 fr-mb-0">
										Inscrire un candidat
									</h4>

									<div class="fr-col-md-10 fr-col-lg-8">
										<div class="fr-checkbox-group">
											<input name="checkbox" id="check-candidatures-libres" type="checkbox" {{ election.candidaturesLibres ? "checked" : "" }} aria-describedby="checkbox-messages">
											<label class="fr-label" for="check-candidatures-libres">
												Autoriser les candidatures spontanées
												<span class="fr-hint-text">Sous réserve pour l'utilisateur de se trouver dans le&nbsp;
													<abbr title="Corps d'appartenance et unité">périmètre de l'élection</abbr>
												</span>
											</label>
											<div class="fr-messages-group" id="check-candidatures-libres-messages" aria-live="polite"></div>
										</div>
									</div>

									<div class="fr-col-md-10 fr-col-lg-8 fr-mb-2w">
										<div class="fr-input-group relative" id="input-group-suggest-candidat">
											<label class="fr-label" for="suggest-candidat">
												Recherche d'utilisateur
												<span class="fr-hint-text">Recherche possible par nom ou par nigend.</span>
											</label>
											<input class="fr-input" id="suggest-candidat" type="search" placeholder="Nom ou nigend de l'utilisateur" data-list="suggest-candidat-list">
											<ul
												class="fr-messages-group suggest-candidat-list" id="suggest-candidat-list" aria-live="polite"><!-- Les suggestions sont insérées ici par JavaScript -->
											</ul>
										</div>
									</div>
									<div class="fr-col-md-2 fr-col-lg-4 fr-mb-2w">
										<div class="fr-input-group">
											<label class="fr-label" for="suggestion-submit">
												&nbsp;
												<span class="fr-hint-text">&nbsp;</span>
											</label>
											<button type="button" class="fr-btn fr-btn--primary fr-mt-1w fr-hidden" id="suggestion-submit">Ajouter</button>
										</div>
									</div>

								</div>
								{# </div> #}
							</form>

						{% endif %}

						<div id="error-insertion-candidat" class="fr-alert fr-alert--error fr-hidden">
							<h3 id="error-insertion-candidat__title" class="fr-alert__title"></h3>
						</div>

						<div class="fr-table fr-table--no-scroll fr-col-12" id="table-candidats-component">
							<div class="fr-table__wrapper">
								<div class="fr-table__container">
									<div class="fr-table__content">
										<table id="table-candidats">
											<caption class="fr-hidden">Candidats inscrits</caption>
											<thead>
												<tr>
													<th>
														Nigend
													</th>
													<th>
														Utilisateur
													</th>
													<th>
														Action
													</th>
												</tr>
											</thead>
											<tbody id="candidats-tbody">
												{% for candidat in election.candidats %}

													<tr id="table-candidats-row-key-1" data-row-key="1">
														<td>
															{{ candidat.userId }}
														</td>
														<td>
															{{ candidat.displayname }}
														</td>
														<td>
															{% if candidat.displayname != 'VOTE BLANC' and not spontanee %}
																<button type="button" data-nigend="{{ candidat.userId }}" title="Retirer de la liste" class="fr-btn fr-icon-delete-line fr-btn--tertiary-no-outline">
																	Retirer de la liste
																</button>
															{% endif %}
														</td>
													</tr>

												{% else %}

													<tr id="table-zero-candidat" data-row-key="1">
														<td colspan="4" class="center">
															Il n'y a pas encore de candidat pour cette élection.
														</td>
													</tr>

												{% endfor %}
											</tbody>
										</tbody>
									</table>
								</div>
							</div>
						</div>

						{% if spontanee %}

							<div class="fr-grid-row fr-grid-row--gutters">

								<h4 class="fr-h6 fr-col-12 fr-mt-4w fr-mb-0">
									Je soumets ma candidature
								</h4>

								<div class="fr-col-12">
									<div class="fr-checkbox-group">
										<input data-nigend="{{ user.userId }}" data-displayname="{{user.title}}" data-mail="{{user.mail}}" name="checkbox" id="check-candidature-spontanee" type="checkbox" {{ user.userId in (election.candidats.map(c=>c.userId)) ? "checked" : "" }} aria-describedby="checkbox-spontanee-messages">
										<label class="fr-label" for="check-candidature-spontanee">
											En cochant le case ci-contre, je confirme ma volonté de me porter candidat à cette élection.
											<span id="checkbox-spontanee-messages" class="fr-hint-text">
												Vous avez la possibilité de retirer votre candidature tant que les votes ne sont pas ouverts, soit jusqu'au
												{{ election.startDate | date('d/m/Y à H:i') }}.
											</span>
										</label>
										<div class="fr-messages-group" id="check-candidature-spontanee-messages" aria-live="polite"></div>
									</div>
								</div>

							</div>

						{% endif %}
					</div>

				</div>
				<!-- fin .fr-col -->

			{% else %}

				<div class="fr-notice fr-notice--info">
					<div class="fr-container">
						<div class="fr-notice__body">
							<p>
								<span class="fr-notice__title">Aucune élection n'a été trouvée avec les caractéristiques demandées.</span>
								<a href="{{ path('app_election_dashboard') }}" target="_self" class="fr-notice__link">Accédez à cette page depuis le tableau de bord!</a>
							</p>
						</div>
					</div>
				</div>

			{% endif %}

		</div>

	</main>
{% endblock %}
